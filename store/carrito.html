<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="favicon.ico" type="image/x-icon" />
  <title>Carrito - Objetos Perdidos</title>

  <!-- Hoja de estilos global -->
  <link rel="stylesheet" href="styles.css" />
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />

  <!-- Firebase JS SDK -->
  <script type="module">
    import { initializeApp }    from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getFirestore }     from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBrh5AP2ErXaQAcZb0NMHq_5cBrvNZIlWo",
      authDomain: "objetosperdidos-76abd.firebaseapp.com",
      projectId: "objetosperdidos-76abd",
      storageBucket: "objetosperdidos-76abd.firebasestorage.app",
      messagingSenderId: "609690831592",
      appId: "1:609690831592:web:f7a276b069c426ef53175d",
      measurementId: "G-95C30B5EK1"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);
  </script>

  <style>
    :root {
      --verde-principal: #2e9d57;
      --amarillo-abeja: #f9d94e;
      --blanco: #fefefe;
      --negro: #1a1a1a;
    }
    *, *::before, *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      font-family: Arial, Helvetica, sans-serif;
      background: url("img/background.png") center/cover fixed no-repeat;
      color: var(--negro);
    }
    header {
      background: var(--verde-principal);
      padding: 1rem;
      position: relative;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      align-items: center;
      text-align: center;
    }
    .logo { position: absolute; left: 1rem; top: 1rem; }
    .logo img { width: 120px; height: auto; }
    .main-title {
      width: 100%;
      font-size: 2rem;
      color: var(--blanco);
      margin-top: .5rem;
    }
    .burger {
      display: none;
      position: absolute;
      right: 1rem;
      top: 1rem;
      font-size: 1.8rem;
      color: var(--amarillo-abeja);
      cursor: pointer;
    }
    .navbar {
      width: 100%;
      margin-top: .5rem;
    }
    .navbar ul {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 1rem;
      list-style: none;
    }
    .navbar a {
      color: var(--blanco);
      font-weight: 700;
      text-decoration: none;
      transition: .3s;
    }
    .navbar a:hover { color: var(--amarillo-abeja); }
    main {
      padding: 2rem;
      text-align: center;
    }
    #producto-seleccionado {
      background: var(--blanco);
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
      padding: 1rem;
      margin-bottom: 2rem;
      text-align: left;
      max-width: 600px;
      margin: 0 auto;
    }
    #producto-seleccionado img {
      width: 100%;
      border-radius: 5px;
      margin-bottom: 1rem;
    }
    form {
      background: var(--blanco);
      padding: 1rem;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,.1);
      display: grid;
      gap: 1rem;
      max-width: 600px;
      margin: 0 auto;
    }
    form label { font-weight: bold; }
    form input,
    form select {
      width: 100%;
      padding: .5rem;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    form button {
      padding: .75rem;
      background: var(--amarillo-abeja);
      color: var(--negro);
      border: none;
      border-radius: 5px;
      font-weight: bold;
      cursor: pointer;
      transition: background .3s;
    }
    form button:hover {
      background: var(--verde-principal);
      color: var(--blanco);
    }
    #codigo {
      margin-top: 1rem;
      padding: 1rem;
      background: #e8ffe8;
      border: 1px solid var(--verde-principal);
      border-radius: 5px;
      font-weight: bold;
      text-align: center;
      max-width: 600px;
      margin: 0 auto;
    }
    footer {
      text-align: center;
      padding: 1rem;
      background: var(--verde-principal);
      color: var(--blanco);
      margin-top: 2rem;
    }
    @media(max-width:768px){
      .burger { display: block; }
      .navbar ul { display: none; }
      .navbar ul.active { display: flex; flex-direction: column; }
      header { flex-direction: column; padding-top: 1rem; }
      .logo, .burger { position: static; margin: .5rem 0; }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo"><img src="img/logto wilferson.png" alt="Logo" /></div>
    <h1 class="main-title">RECLAMAR OBJETO</h1>
    <div class="burger"><i class="fas fa-bars"></i></div>
    <nav class="navbar">
      <ul>
        <li><a href="../index.html">Inicio</a></li>
        <li><a href="productos.html">Objetos</a></li>
        <li><a href="admin.html">Administrador</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <h2>Producto Seleccionado</h2>
    <div id="producto-seleccionado"><p>Cargando...</p></div>

    <h2>Datos del Usuario</h2>
    <form id="client-form">
      <div><label for="selected-name">Objeto seleccionado</label>
        <input type="text" id="selected-name" readonly /></div>
      <div><label for="cliente-nombre">Nombre</label>
        <input type="text" id="cliente-nombre" required /></div>
      <div><label for="cliente-doc">Tipo de documento</label>
        <select id="cliente-doc" required>
          <option value="">-- Seleccione --</option>
          <option value="Cédula de ciudadanía">Cédula de ciudadanía</option>
          <option value="Tarjeta de identidad">Tarjeta de identidad</option>
          <option value="Pasaporte">Pasaporte</option>
        </select></div>
      <div><label for="cliente-id">Número de documento</label>
        <input type="number" id="cliente-id" required /></div>
      <div><label for="cliente-facultad">Facultad o dependencia</label>
        <input type="text" id="cliente-facultad" required /></div>
      <div><label for="cliente-telefono">Teléfono</label>
        <input type="tel" id="cliente-telefono" required /></div>
      <div><label for="cliente-correo">Correo institucional</label>
        <input type="email" id="cliente-correo" required /></div>
      <button type="submit">Enviar</button>
    </form>
    <div id="codigo" style="display:none;"></div>
  </main>

  <footer>&copy; 2025 Infraestructura y Planta Física.</footer>

  <script>
    document.querySelector(".burger")
      .addEventListener("click", () =>
        document.querySelector(".navbar ul").classList.toggle("active")
      );
  </script>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBrh5AP2ErXaQAcZb0NMHq_5cBrvNZIlWo",
      authDomain: "objetosperdidos-76abd.firebaseapp.com",
      projectId: "objetosperdidos-76abd",
      storageBucket: "objetosperdidos-76abd.firebasestorage.app",
      messagingSenderId: "609690831592",
      appId: "1:609690831592:web:f7a276b069c426ef53175d",
      measurementId: "G-95C30B5EK1"
    };
    const app = initializeApp(firebaseConfig);
    const db  = getFirestore(app);

    const params       = new URLSearchParams(window.location.search);
    const objId        = params.get("id");
    const objNameParam = params.get("name");
    const contProducto = document.getElementById("producto-seleccionado");
    const selectedName = document.getElementById("selected-name");

    async function mostrarProducto() {
      if (!objId) {
        contProducto.innerHTML = "<p>No se seleccionó ningún objeto.</p>";
        return;
      }
      contProducto.innerHTML = "<p>Cargando objeto...</p>";
      try {
        const snap = await getDoc(doc(db, "objects", objId));
        if (!snap.exists()) {
          contProducto.innerHTML = "<p>Objeto no encontrado.</p>";
          return;
        }
        const o = snap.data();
       	selectedName.value = objNameParam || o.name;
        contProducto.innerHTML = `
          <img src="${o.imageUrl||'https://via.placeholder.com/400'}" alt="${o.name}" />
          <h3>${o.name}</h3>
          <p><strong>Descripción:</strong> ${o.description}</p>
          <p><strong>Lugar:</strong> ${o.location}</p>
        `;
      } catch (err) {
        console.error(err);
        contProducto.innerHTML = "<p>Error al cargar el objeto.</p>";
      }
    }
    mostrarProducto();

    function generarCodigo() {
      const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
      return Array.from({ length: 6 })
        .map(() => chars.charAt(Math.floor(Math.random() * chars.length)))
        .join("");
    }

    document.getElementById("client-form")
      .addEventListener("submit", e => {
        e.preventDefault();
        const nombre     = document.getElementById("cliente-nombre").value.trim();
        const docType    = document.getElementById("cliente-doc").value;
        const facultad   = document.getElementById("cliente-facultad").value.trim();
        const telefono   = document.getElementById("cliente-telefono").value.trim();
        const correo     = document.getElementById("cliente-correo").value.trim();
        const objetoName = selectedName.value;
        const codigo     = generarCodigo();

        const divCod = document.getElementById("codigo");
        divCod.textContent = `Este es tu código de radicado: ${codigo}`;
        divCod.style.display = "block";

        let body = `Código de radicado: ${codigo}\n\n`;
        body += `Objeto reclamado: ${objetoName}\n\n`;
        body += `-- Datos del cliente --\n`;
        body += `Nombre: ${nombre}\n`;
        body += `Documento: ${docType}\n`;
        body += `Facultad o dependencia: ${facultad}\n`;
        body += `Teléfono: ${telefono}\n`;
        body += `Correo institucional: ${correo}\n`;

        const mailto = `mailto:hdaza@universidadean.edu.co`
                     + `?cc=${encodeURIComponent(correo)}`
                     + `&subject=${encodeURIComponent("Entrega de objeto perdido")}`
                     + `&body=${encodeURIComponent(body)}`;
        window.location.href = mailto;
      });
  </script>
</body>
</html>
